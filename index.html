<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>

<body>
    <canvas id="canvas"></canvas>
    <script>
        digit = [
            [
                [0, 0, 1, 1, 1, 0, 0],
                [0, 1, 1, 0, 1, 1, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 0, 1, 1, 0],
                [0, 0, 1, 1, 1, 0, 0]
            ], //0
            [
                [0, 0, 0, 1, 1, 0, 0],
                [0, 1, 1, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [1, 1, 1, 1, 1, 1, 1]
            ], //1
            [
                [0, 1, 1, 1, 1, 1, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 1, 1, 0, 0, 0],
                [0, 1, 1, 0, 0, 0, 0],
                [1, 1, 0, 0, 0, 0, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 1, 1, 1, 1, 1]
            ], //2
            [
                [1, 1, 1, 1, 1, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 1, 1, 1, 0, 0],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 1, 1, 1, 0]
            ], //3
            [
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 1, 1, 1, 0],
                [0, 0, 1, 1, 1, 1, 0],
                [0, 1, 1, 0, 1, 1, 0],
                [1, 1, 0, 0, 1, 1, 0],
                [1, 1, 1, 1, 1, 1, 1],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 1, 1, 1, 1]
            ], //4
            [
                [1, 1, 1, 1, 1, 1, 1],
                [1, 1, 0, 0, 0, 0, 0],
                [1, 1, 0, 0, 0, 0, 0],
                [1, 1, 1, 1, 1, 1, 0],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 1, 1, 1, 0]
            ], //5
            [
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 1, 1, 0, 0, 0],
                [0, 1, 1, 0, 0, 0, 0],
                [1, 1, 0, 0, 0, 0, 0],
                [1, 1, 0, 1, 1, 1, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 1, 1, 1, 0]
            ], //6
            [
                [1, 1, 1, 1, 1, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 0, 1, 1, 0, 0, 0],
                [0, 0, 1, 1, 0, 0, 0],
                [0, 0, 1, 1, 0, 0, 0],
                [0, 0, 1, 1, 0, 0, 0]
            ], //7
            [
                [0, 1, 1, 1, 1, 1, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 1, 1, 1, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 1, 1, 1, 0]
            ], //8
            [
                [0, 1, 1, 1, 1, 1, 0],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [1, 1, 0, 0, 0, 1, 1],
                [0, 1, 1, 1, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 0, 1, 1],
                [0, 0, 0, 0, 1, 1, 0],
                [0, 0, 0, 1, 1, 0, 0],
                [0, 1, 1, 0, 0, 0, 0]
            ], //9
            [
                [0, 0, 0, 0],
                [0, 0, 0, 0],
                [0, 1, 1, 0],
                [0, 1, 1, 0],
                [0, 0, 0, 0],
                [0, 0, 0, 0],
                [0, 1, 1, 0],
                [0, 1, 1, 0],
                [0, 0, 0, 0],
                [0, 0, 0, 0]
            ] //:
        ];
        var WINDOW_WIDTH = 1200;
        var WINDOW_HEIGHT = 900;
        var MARGIN_LEFT = 20;
        var MARGIN_TOP = 30;
        var r = 8;

        const endTime = new Date(2017, 0, 6, 11, 15, 22);
        var curShowTimeSeconds = getCurrentShowTimeSeconds();
        var balls = [];
        const colors = ['#33b5e3', '#0099cc', '#aa66cc', '#9933cc', '#669900', '#ffbb33', '#ff8800', '#ff4444', '#cc0000'];
        window.onload = function() {
            var canvas = document.getElementById('canvas');
            var context = canvas.getContext('2d');

            canvas.width = WINDOW_WIDTH;
            canvas.height = WINDOW_HEIGHT;
            setInterval(function() {
                render(context)
                upDate();
            }, 50)
        }

        function getCurrentShowTimeSeconds() {
            var curTimes = new Date();
            var ret = endTime.getTime() - curTimes.getTime();
            ret = Math.round(ret / 1000)
            return ret >= 0 ? ret : 0;
        }

        function upDate() {
            var nextShowTimeSeconds = getCurrentShowTimeSeconds();
            var nextHour = parseInt(nextShowTimeSeconds / 3600)
            var nextMinute = parseInt((nextShowTimeSeconds - nextHour * 3600) / 60)
            var nextSeconds = nextShowTimeSeconds % 60

            var curHour = parseInt(curShowTimeSeconds / 3600)
            var curMinute = parseInt((curShowTimeSeconds - curHour * 3600) / 60)
            var curSeconds = curShowTimeSeconds % 60

            if (nextSeconds != curSeconds) {
                if (parseInt(curHour / 10) != parseInt(nextHour / 10)) {
                    addBalls(MARGIN_LEFT, MARGIN_TOP, parseInt(curHour / 10))
                }
                if (parseInt(curHour % 10) != parseInt(nextHour % 10)) {
                    addBalls(MARGIN_LEFT + 15 * (r + 1), MARGIN_TOP, parseInt(curHour % 10))
                }
                if (parseInt(curMinute / 10) != parseInt(nextMinute / 10)) {
                    addBalls(MARGIN_LEFT + 45 * (r + 1), MARGIN_TOP, parseInt(curMinute / 10))
                }
                if (parseInt(curMinute % 10) != parseInt(nextMinute % 10)) {
                    addBalls(MARGIN_LEFT + 60 * (r + 1), MARGIN_TOP, parseInt(curMinute % 10))
                }
                if (parseInt(curSeconds / 10) != parseInt(nextSeconds / 10)) {
                    addBalls(MARGIN_LEFT + 90 * (r + 1), MARGIN_TOP, parseInt(curSeconds / 10))
                }
                if (parseInt(curSeconds % 10) != parseInt(nextSeconds % 10)) {
                    addBalls(MARGIN_LEFT + 105 * (r + 1), MARGIN_TOP, parseInt(curSeconds % 10))
                }
                curShowTimeSeconds = nextShowTimeSeconds
            }
            upDateBalls();
            console.log(balls.length)
        }

        function addBalls(x, y, num) {
            for (var i = 0; i < digit[num].length; i++) {
                for (var j = 0; j < digit[num][i].length; j++) {
                    if (digit[num][i][j] == 1) {
                        var aBall　 = 　 {
                            x: x + j * 2 * (r + 1) + r + 1,
                            y: y + i * 2 * (r + 1) + r + 1,
                            g: 1.5 + Math.random(),
                            vx: Math.pow(-1, Math.ceil(Math.random() * 1000)) * 4,
                            vy: -5,
                            color: colors[Math.floor(Math.random() * colors.length)]
                        }
                        balls.push(aBall)
                    }
                }
            }
        }

        function upDateBalls() {
            for (var i = 0; i < balls.length; i++) {
                balls[i].x += balls[i].vx;
                balls[i].y += balls[i].vy;
                balls[i].vy += balls[i].g;

                if (balls[i].y >= WINDOW_HEIGHT - r) {
                    balls[i].y = WINDOW_HEIGHT - r;
                    balls[i].vy = -balls[i].vy * 0.75
                }
            }
        }

        function render(cxt) {
            // cxt.beginPath()
            cxt.clearRect(0, 0, 2000, 2000);
            var hour = parseInt(curShowTimeSeconds / 3600);
            var minute = parseInt((curShowTimeSeconds - hour * 3600) / 60);
            var seconds = curShowTimeSeconds % 60;

            renderDigit(MARGIN_LEFT, MARGIN_TOP, parseInt(hour / 10), cxt)
            renderDigit(MARGIN_LEFT + 15 * (r + 1), MARGIN_TOP, parseInt(hour % 10), cxt)
            renderDigit(MARGIN_LEFT + 30 * (r + 1), MARGIN_TOP, 10, cxt)
            renderDigit(MARGIN_LEFT + 45 * (r + 1), MARGIN_TOP, parseInt(minute / 10), cxt)
            renderDigit(MARGIN_LEFT + 60 * (r + 1), MARGIN_TOP, parseInt(minute % 10), cxt)
            renderDigit(MARGIN_LEFT + 75 * (r + 1), MARGIN_TOP, 10, cxt)
            renderDigit(MARGIN_LEFT + 90 * (r + 1), MARGIN_TOP, parseInt(seconds / 10), cxt)
            renderDigit(MARGIN_LEFT + 105 * (r + 1), MARGIN_TOP, parseInt(seconds % 10), cxt)
            for (var i = 0; i < balls.length; i++) {
                cxt.beginPath();
                cxt.fillStyle = balls[i].color;
                cxt.arc(balls[i].x, balls[i].y, r, 0, 2 * Math.PI, true);
                cxt.closePath();
                cxt.fill()
            }
        }

        function renderDigit(x, y, num, cxt) {
            cxt.fillStyle = "rgba(0,102,153)";

            for (var i = 0; i < digit[num].length; i++) {
                for (var j = 0; j < digit[num][i].length; j++) {
                    if (digit[num][i][j] == 1) {
                        cxt.arc(x + j * 2 * (r + 1) + r + 1, y + i * 2 * (r + 1), r, 0, Math.PI * 2);
                        cxt.closePath()
                        cxt.fill()
                    }
                }
            }
        }
    </script>
</body>

</html>